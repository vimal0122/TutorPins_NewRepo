@page "/students/studentsubjects/{id}"
@inherits StudentSubjectsBase
<div class="row mt-4">
    <div class="col-8">
        <h4 class="card-title text-info">
            @StudentName - Subjects
        </h4>
    </div>
    
</div>
<div class="row mt-4">
    <div class="col-12">


        <SfGrid ID="gridStudents" @ref="Grid" DataSource="@SubjectDetails" AllowPaging="true" AllowSorting="true" EnablePersistence=true AllowFiltering="true">
           
            <GridFilterSettings Type="Syncfusion.Blazor.Grids.FilterType.Menu"></GridFilterSettings>
            <GridPageSettings PageSize="20"></GridPageSettings>
            <GridColumns>
                
                <GridColumn Field=@nameof(StudentSubjectDto.SubjectFullName) HeaderText="Subject" Width="115"></GridColumn>
                <GridColumn Field=@nameof(StudentSubjectDto.DurationPerWeek) HeaderText="(Hours/week)" Width="95"></GridColumn>
                <GridColumn Field=@nameof(StudentSubjectDto.PreferedTimeSlots) HeaderText="Time Slots" Width="90"></GridColumn>
                @* <GridColumn Field=@nameof(StudentSubjectDto.TutorMatched) HeaderText="Match Tutor" Width="70" Visible="false">
                    <Template>
                        @{
                            var student = (context as StudentSubjectDto);
                            <div class="template_checkbox">
                                @if (student.TutorMatched.HasValue && student.TutorMatched.Value)
                                {
                                    <input type="checkbox" checked disabled>
                                }
                                else
                                {
                                    <input type="checkbox" disabled>
                                }
                            </div>
                        }
                    </Template>
                </GridColumn> *@
                <GridColumn Field=@nameof(StudentSubjectDto.CreatedDate) HeaderText="Requested On" Width="80" >
                    <Template>
                        @{
                            var student = (context as StudentSubjectDto);
                            <span>@student?.CreatedDate.Value.ToString("dd-MMM-yyyy")</span>
                        }
                    </Template>
                </GridColumn>
                <GridColumn Field=@nameof(StudentSubjectDto.TutorMatchStatus) HeaderText="Match Status" Width="90"></GridColumn>
                <GridColumn  TextAlign="TextAlign.Left" Width="180">
                    <Template>
                        @{
                            var s = (context as StudentSubjectDto);
                            <div>
                                <a href="/tutors/matchtutor/@s.Id">Match Tutor</a>
                                <SfButton Content="No Show" IconCss="e-icons e-update" OnClick="@(()=>UpdateStatus(s))"></SfButton>
                                <SfButton Content="Log" IconCss="e-icons e-view-details" OnClick="@(()=>ShowLog(s))"></SfButton>
                            </div>
                           
                        }                       
                    </Template>
                </GridColumn>
                
            </GridColumns>
        </SfGrid>

        <SfDialog @ref="StatusDialog" Width="500px" Visible="false" ShowCloseIcon="true" IsModal="true">
            <DialogEvents Closed="StatusClosed"></DialogEvents>
            <DialogTemplates>
                @*Here you can customize the Header and Content of delete confirmation dialog*@
                <Header> Tutor - Status Update</Header>
                <Content>
                    <div class="row mt-1">
                        <div class="col-xs-3 col-sm-3 col-lg-3 col-md-3">
                            <h6>Status</h6>
                        </div>
                        <div class="col-xs-8 col-sm-8 col-lg-8 col-md-8">
                            <SfDropDownList TValue="string" TItem="GeneralText" @bind-Value="@SelectedMatchStatusId" DataSource="@MatchStatusList">
                                <DropDownListFieldSettings Text="Name" Value="Id"></DropDownListFieldSettings>
                            </SfDropDownList>
                        </div>

                    </div>
                    <div class="row mt-2">
                        <div class="col-xs-3 col-sm-3 col-lg-3 col-md-3">
                            <h6>Remarks</h6>
                        </div>
                        <div class="col-xs-8 col-sm-8 col-lg-8 col-md-8">
                            <SfTextBox style="height: 90px" Multiline=true @bind-Value="@MatchRemarks"></SfTextBox>

                        </div>

                    </div>
                </Content>
            </DialogTemplates>
            <DialogButtons>
                <DialogButton OnClick="@OkStatusClick" Content="OK" IsPrimary="true"></DialogButton>
                <DialogButton OnClick="@CancelStatusClick" Content="Cancel"></DialogButton>
            </DialogButtons>
        </SfDialog>
        <SfDialog @ref="LogDialog" Width="580px" Visible="false" ShowCloseIcon="true" IsModal="true">
            <DialogTemplates>
                @*Here you can customize the Header and Content of delete confirmation dialog*@
                <Header> Request Log</Header>
                <Content>                    
                    <StudentRequestLog RequestLogs="studentRequestLogDtoList"></StudentRequestLog>
                </Content>
            </DialogTemplates>
            
        </SfDialog>
        <SfSpinner @ref="@SpinnerObj"></SfSpinner>
    </div>
    <div class="col-xs-12 col-sm-12 col-lg-12 col-md-12 mt-2" style="text-align:right">
        <SfButton IsPrimary="true" OnClick="@onBackclick">Back</SfButton>
    </div>
</div>